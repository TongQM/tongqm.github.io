---
layout:   post
title:    "动态规划求解有限期不均匀需求最优订货方案"
date:     2020-02-02
author:   "miao"
mathjax:  true
---



# 动态规划求解有限期不均匀需求最优订货方案

其实这个算法叫Wagner-Whitin算法，也叫Dynamic lot-size model, 可以轻易通过手算得出最优的订货方案，（注意是严格最优哦不是Silver-Meal那种满意解），由Harvey M. Wagner 和 Thomson M. Whitin 在 1958年提出。接下来就按照这个算法，吃一吃上课那道题的瓜。

## 基本思想

基本思想还是固定成本和库存成本之前的权衡取舍以求总成本最小，不用可虑可变成本的原因是因为一进货的单位价格固定二也不考虑资金的时间价值三需求是已知的也不用考虑安全库存的问题。理论建模太麻烦，就干脆直接结合题目说吧。

## 题目

固定成本$K=10$,     
库存成本$h=0.01$/件周,    
延迟$\tau=3$周,    
初始库存$I_0=90$。

然后给出了1-10周各自的需求量,    

|:----------------------------:|
| 1| 2| 3| 4| 5| 6| 7| 8|  9|10|
|:----------------------------:|
|30|50|10|20|70|80|20|60|200|50|
|:----------------------------:|

其实原模型里是没有考虑到延迟期和初始库存这回事的，不过对于这道题来说也好解决。很好观察到前三周的需求总和正好是90，所以实际上我们规划的就是后面7周的订货方案，不妨假设延迟为0，当即到货，到最后的时候再把订货方案都提前三周就行。

我们有需求，  

|:-------------------:|
| 4| 5| 6| 7| 8|  9|10|
|:-------------------:|
|20|70|80|20|60|200|50|
|:-------------------:|

然后我们就列一个空的成本矩阵,    

|:---------------------:|
|  | 4| 5| 6| 7| 8| 9|10|
|----------------------:|
| 4|  |  |  |  |  |  |  |
| 5| -|  |  |  |  |  |  |
| 6| -| -|  |  |  |  |  |
| 7| -| -| -|  |  |  |  |
| 8| -| -| -| -|  |  |  |
| 9| -| -| -| -| -|  |  |
|10| -| -| -| -| -| -|  |
|:---------------------:|

解释一下，行标的意思是最后一次订货的那周，列标是考虑问题的规模，比如“4”这列意思就是我们只考虑一周（第四周）的订货，因为不考虑接下来的周，所以最后一次订货机会只可能在第四周，这一列下面就全用“-”表示，意思是不可能存在成本。类似的，“5”这列意思就是只考虑第四和第五周，下面的周都不考虑，而最后一次订货可能在第四周，也可能在第五周。

然后我们开始向这个成本矩阵里面填成本，这个成本是基于现在考虑的问题的规模而言的总成本，“6”列第一行意思就是当我们只考虑四五六周的时候，如果最后一次订货在第四周，即第四周就把这三周的所有需求订完了 的总成本。

我们首先填第一列，很简单因为没有跨期库存成本在期末的计算，所以这个空就是一次固定成本，10。

|:---------------------:|
|  | 4| 5| 6| 7| 8| 9|10|
|----------------------:|
| 4|10|  |  |  |  |  |  |
| 5| -|  |  |  |  |  |  |
| 6| -| -|  |  |  |  |  |
| 7| -| -| -|  |  |  |  |
| 8| -| -| -| -|  |  |  |
| 9| -| -| -| -| -|  |  |
|10| -| -| -| -| -| -|  |
|:---------------------:|

然后我们填第二列，这时候对于第一个空我们就要注意了，因为最后一次订货是在第四周，所以第四周的时候我们把第五周的货也订了，就产生了额外的一个跨期的库存成本,    

$$c_{45}=10+70\times 0.01\times 1=10.7$$

其中70是第五周的需求，后面乘1是因为只跨了一期。然后假如最后一次订货在第五周，那么我们的总成本就是两次订货的固定成本,   

$$c_{55}=10+10=20$$

填进矩阵里,   

|:-----------------------:|
|  | 4|   5| 6| 7| 8| 9|10|
|------------------------:|
| 4|10|10.7|  |  |  |  |  |
| 5| -|  20|  |  |  |  |  |
| 6| -|   -|  |  |  |  |  |
| 7| -|   -| -|  |  |  |  |
| 8| -|   -| -| -|  |  |  |
| 9| -|   -| -| -| -|  |  |
|10| -|   -| -| -| -| -|  |
|:-----------------------:|

好到目前为止都没有什么问题，接下来我们考虑第三列也就是“6”这列，第一个空就要考虑到第五周和第六周的库存成本，因为第五周的需求仍旧只是跨了一期，第六周的成本跨了两期，所以就是多了两期第六周需求的库存成本,   

$$c_{46}=c_{45}+80\times 0.01\times 2=12.3$$

类似的,  

$$c_{56}=c_{55}+80\times 0.01\times 1=20.8$$

|:-------------------------:|
|  | 4|   5|   6| 7| 8| 9|10|
|--------------------------:|
| 4|10|10.7|12.3|  |  |  |  |
| 5| -|  20|20.8|  |  |  |  |
| 6| -|   -|    |  |  |  |  |
| 7| -|   -|   -|  |  |  |  |
| 8| -|   -|   -| -|  |  |  |
| 9| -|   -|   -| -| -|  |  |
|10| -|   -|   -| -| -| -|  |
|:-------------------------:|

然后我们考虑$c_{66}$，这个时候动态规划的思想就要体现出来了，根据最优化原理，小规模问题的最优路径肯定也是包含它的较大问题的最优路径的一部分，否则较大问题的最优路径就不最优了。假定最后一次订货在第六周，那么对于之前的需求肯定还有一次订货，应该就在第四周，因为在第二列（“5”列）种我们可以看到第四周订四五周的货的成本是要小于四五周各订一次货的成本的，所以我们第四周订一次货，到第六周才要再订一次货，成本为,

$$c_{66}=min(c_{45},c_{55})+10=20.7$$

|:-------------------------:|
|  | 4|   5|   6| 7| 8| 9|10|
|--------------------------:|
| 4|10|10.7|12.3|  |  |  |  |
| 5| -|  20|20.8|  |  |  |  |
| 6| -|   -|20.7|  |  |  |  |
| 7| -|   -|   -|  |  |  |  |
| 8| -|   -|   -| -|  |  |  |
| 9| -|   -|   -| -| -|  |  |
|10| -|   -|   -| -| -| -|  |
|:-------------------------:|


这时候我们突然注意到$c_{56>c_{66}}$，如果继续扩大问题的规模，如果最后一次订货分别在第五周和第六周的话，那么由于第五周要比第六周多跨一期，第五周的总成本增加的肯定要比第六周快，也就是说，第六周最后一次订货肯定要比第五周最后一次订货要好，无论问题规模多大。所以接下来“5”行我们就不用算了，最低成本肯定不会出现在这一行，我们用“-”抹去这一行。

|:-------------------------:|
|  | 4|   5|   6| 7| 8| 9|10|
|--------------------------:|
| 4|10|10.7|12.3|  |  |  |  |
| 5| -|  20|20.8| -| -| -| -|
| 6| -|   -|20.7|  |  |  |  |
| 7| -|   -|   -|  |  |  |  |
| 8| -|   -|   -| -|  |  |  |
| 9| -|   -|   -| -| -|  |  |
|10| -|   -|   -| -| -| -|  |
|:-------------------------:|


其实因为库存成本，问题规模越大，标号小的行的成本增加的肯定比标号大的行的成本增加的要快，只不过很多情况下标号低的行的成本要低于同列的标号大的成本，我们不知道它在问题结束之前能不能赶上。

然后就没有什么要注意的了，对于“7”列，

$$c_{47}=c_{46}+20\times 0.01\times 3=12.9$$    
$$c_{67}=c_{66}+20\times 0.01\times 1=20.9$$    
$$c_{77}=min(c_{i6},i=4,5,6)+10=22.3$$

|:---------------------------:|
|  | 4|   5|   6|   7| 8| 9|10|
|----------------------------:|
| 4|10|10.7|12.3|12.9|  |  |  |
| 5| -|  20|20.8|   -| -| -| -|
| 6| -|   -|20.7|20.9|  |  |  |
| 7| -|   -|   -|22.3|  |  |  |
| 8| -|   -|   -|   -|  |  |  |
| 9| -|   -|   -|   -| -|  |  |
|10| -|   -|   -|   -| -| -|  |
|:---------------------------:|

又注意到$c_{67}>c_{77}$，划掉“6”行。

|:---------------------------:|
|  | 4|   5|   6|   7| 8| 9|10|
|----------------------------:|
| 4|10|10.7|12.3|12.9|  |  |  |
| 5| -|  20|20.8|   -| -| -| -|
| 6| -|   -|20.7|20.9| -| -| -|
| 7| -|   -|   -|22.3|  |  |  |
| 8| -|   -|   -|   -|  |  |  |
| 9| -|   -|   -|   -| -|  |  |
|10| -|   -|   -|   -| -| -|  |
|:---------------------------:|

“8”列,   

$$c_{48}=c_{47}+60\times 0.01\times 4=15.3$$   
$$c_{78}=c_{77}+60\times 0.01\times 1=22.9$$   
$$c_{88}=min(c_{i7},i=4,5,6,7)+10=22.9$$

又因为$c_{78}=c_{88}$，划掉“7”行。

|:-----------------------------:|
|  | 4|   5|   6|   7|   8| 9|10|
|------------------------------:|
| 4|10|10.7|12.3|12.9|15.3|  |  |
| 5| -|  20|20.8|   -|   -| -| -|
| 6| -|   -|20.7|20.9|   -| -| -|
| 7| -|   -|   -|22.3|22.9| -| -|
| 8| -|   -|   -|   -|22.9|  |  |
| 9| -|   -|   -|   -|   -|  |  |
|10| -|   -|   -|   -|   -| -|  |
|:-----------------------------:|

“9”列,   

$$c_{49}=c_{48}+200\times 0.01\times 5=25.3$$   
$$c_{89}=c_{88}+200\times 0.01\times 1=24.9$$   
$$c_{99}=min(c_{i8},i=4,5,6,7,8)+10=25.3$$

|:-------------------------------:|
|  | 4|   5|   6|   7|   8|   9|10|
|--------------------------------:|
| 4|10|10.7|12.3|12.9|15.3|25.3| -|
| 5| -|  20|20.8|   -|   -|   -| -|
| 6| -|   -|20.7|20.9|   -|   -| -|
| 7| -|   -|   -|22.3|22.9|   -| -|
| 8| -|   -|   -|   -|22.9|24.9|  |
| 9| -|   -|   -|   -|   -|25.3|  |
|10| -|   -|   -|   -|   -|   -|  |
|:-------------------------------:|

可以看到，$c_{49}$由于突然变大的需求已经“追上”了$c_{89}$和$c_{99}$。

“10”列,

$$c_{810}=c_{89}+50\times 0.01\times 2=25.9$$   
$$c_{910}=c_{99}+50\times 0.01\times 1=25.8$$   
$$c_{1010}=min(c_{i8},i=4,5,6,7,8,9)+10=34.9$$

|:-------------------------------------:|
|  | 4|   5|   6|   7|     8|   9|    10|
|--------------------------------------:|
| 4|10|10.7|12.3|12.9|*15.3*|25.3|     -|
| 5| -|  20|20.8|   -|     -|   -|     -|
| 6| -|   -|20.7|20.9|     -|   -|     -|
| 7| -|   -|   -|22.3|  22.9|   -|     -|
| 8| -|   -|   -|   -|  22.9|24.9|  25.9|
| 9| -|   -|   -|   -|     -|25.3|*25.8*|
|10| -|   -|   -|   -|     -|   -|  34.9|
|:-------------------------------------:|

如此我们这个成本矩阵也就完成了，我们只需要观察最后一列，发现$c_{910}=25.8$最小，也就是说最后一次订货在第九周，然后溯洄到问题规模为八周的时候，发现$c_{48}=15.3$最小，然后我们就发现了成本最小的最优路径：第四周的时候现订一次以满足四五六七八周的需求，第九周的时候再订一次货以满足第九周和第十周的需求。

如果考虑到延迟，我们就提前三周，即初始库存满足一二三周的需求，第一周的时候订250件第四周到达以满足四五六七八周的需求，第九周的时候再订250件以满足第九十周的需求。最后总成本为25.8，是要小于我们上课通过Silver-Meal得到的成本的，但我们没有考虑到初始库存在第一二三周产生的跨期费用，我们加上它,   

$$c_{total}=25.8+50\times 0.01\times 1+10\times 0.01\times 2=26.5$$

成本是和Silver-Meal的成本一样的，实际上我们的订货方案也和Silver-Meal一样，说明针对这个问题Silver-Meal得出的方案恰好是最优方案，但对于其他问题Silver-Meal并不一定能做到这一点。

## 其他

其实老师上课抛出这个问题我是很诧异的，我是在MRP系统板块学习这个算法的，因为针对MRP系统就有了分期这个概念，时间在这种情况下被等分了，库存产生的成本也是按照每期去算的。而对于一般的库存管理模型而言，时间应该是连续的，不过这一点也没有什么大碍。

我觉得我已经写的很详细了，感兴趣的同学可以仔细看看，也欢迎与我交流。顺便提一嘴，老师PPT里的Silver-Meal是对期数进行成本平均的，其实还有一种Silver-Meal是对存货数进行平均的，感兴趣的同学可以试试，看看得出的方案是不是还是一样。